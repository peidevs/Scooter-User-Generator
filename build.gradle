
apply plugin: 'java'

sourceSets {
    main {
        java {
            srcDir 'src'
        }
    }
    test {
        java { 
            srcDir 'test'
        }
    }
}

configurations {
    releaseJars
}

repositories {
    mavenCentral()
}

dependencies {
    compile 'com.google.code.gson:gson:2.3.1'

    testCompile 'junit:junit:4.11'
   
    releaseJars 'com.google.code.gson:gson:2.3.1'
}

task init(dependsOn: [ 'cleanup']) {
    mkdir "${buildDir}/jars"
    mkdir stagingDir
}

task cleanup {
    delete "${buildDir}"
    delete stagingDir
}

task copyReleaseJars(type: Copy, dependsOn: 'init') {
    into "${buildDir}/jars"
    from configurations.releaseJars
}

jar.archiveName 'ScooterUserGenerator.jar'
jar.manifest {
    attributes 'Main-Class' : 'Generator' 
    attributes 'Class-Path' : 'jars/gson-2.3.1.jar '
}

task scooterBuild(dependsOn: ['test', 'copyReleaseJars', 'jar']) << {
    ant.zip(destfile: "${buildDir}/ScooterUserGenerator.zip") {
        zipfileset(dir: "${buildDir}/jars", prefix: "jars")
        zipfileset(file: "${buildDir}/libs/ScooterUserGenerator.jar")
    }

    ant.unzip(src: "${buildDir}/ScooterUserGenerator.zip", dest: project.stagingDir)
}